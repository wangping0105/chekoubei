# encoding: utf-8
require 'iconv'

namespace :stores do
  desc 'img'
  task :img_get  => :environment do
    p '开始！'
    web_url = "http://dealer.bitauto.com"
    agent = Mechanize.new
    Brand.all.each do |b|
      name = "#{b.pinyin}.png"
      file = File.new("#{Rails.root.to_s}/public/store_imgs/#{name}") if File.exist?("#{Rails.root.to_s}/public/store_imgs/#{name}")
      begin
	    if !file.present? 
	        _url = brands_in_bitauto.select{|br| br[:name] == b.name}[0][:url]
		    root_url = "http://dealer.bitauto.com#{_url}"
		    page = agent.get(root_url)

		    img_url = page.search( ".//img[@alt='logo']/@src").first.try(:value)
		    

	        system("cd #{Rails.root.to_s}/public/store_imgs/ && wget -O #{name} #{img_url}") if img_url.present?
	        sleep 1
	    else
	    	p "skip #{b.name}"
	    end
      rescue
      binding.pry
	    p "have no #{b.name},id: #{b.id}"
      end
    end
  end

  def brands_in_bitauto
    aaa = {char:{A:1,B:1,C:1,D:1,E:0,F:1,G:1,H:1,I:0,J:1,K:1,L:1,M:1,N:1,O:1,P:1,Q:1,R:1,S:1,T:1,U:0,V:0,W:1,X:1,Y:1,Z:1},brand:{A:[{type:"mb",name:"奥迪",url:"/nanjing/audi/",cur:0,num:731},{type:"mb",name:"阿斯顿·马丁",url:"/nanjing/astonmartin/",cur:0,num:20},{type:"mb",name:"阿尔法·罗密欧",url:"/nanjing/alfaromeo/",cur:0,num:1},{type:"mb",name:"AC Schnitzer",url:"/nanjing/acschnitzer/",cur:0,num:0},{type:"mb",name:"Artega",url:"/nanjing/artega/",cur:0,num:0}],B:[{type:"mb",name:"本田",url:"/nanjing/honda/",cur:0,num:1093},{type:"mb",name:"别克",url:"/nanjing/buick/",cur:1,num:820,child:[{type:"cb",name:"上汽通用别克",url:"/nanjing/shanghaitongyongbieke/",cur:0,num:820,child:[{type:"cs",name:"昂科拉ENCORE",url:"/nanjing/encore/",num:801,cur:0},{type:"cs",name:"昂科威ENVISION",url:"/nanjing/envision/",num:794,cur:0},{type:"cs",name:"GL8",url:"/nanjing/biekegl8/",num:795,cur:0},{type:"cs",name:"君威",url:"/nanjing/xinjunwei/",num:802,cur:0},{type:"cs",name:"君越",url:"/nanjing/xinjunyue/",num:802,cur:0},{type:"cs",name:"凯越",url:"/nanjing/xinkaiyue/",num:803,cur:0},{type:"cs",name:"林荫大道",url:"/nanjing/linyindadao/",num:738,cur:0},{type:"cs",name:"威朗轿跑",url:"/nanjing/weilanggs/",num:750,cur:0},{type:"cs",name:"威朗VERANO",url:"/nanjing/weilangverano/",num:780,cur:0},{type:"cs",name:"英朗",url:"/nanjing/yinglangsanxiang/",num:803,cur:0},{type:"cs",name:"英朗XT",url:"/nanjing/xinkaiyuehrv/",num:782,cur:0}]},{type:"cb",name:"进口别克",url:"/nanjing/bieke/",cur:0,num:605,child:[{type:"cs",name:"昂科雷",url:"/nanjing/biekeangkelei/",num:762,cur:0}]}]},{type:"mb",name:"奔驰",url:"/nanjing/mercedesbenz/",cur:0,num:870},{type:"mb",name:"宝马",url:"/nanjing/bmw/",cur:0,num:833},{type:"mb",name:"比亚迪",url:"/nanjing/bydauto/",cur:0,num:579},{type:"mb",name:"宝骏",url:"/nanjing/bj/",cur:0,num:523},{type:"mb",name:"标致",url:"/nanjing/peugeot/",cur:0,num:542},{type:"mb",name:"北汽幻速",url:"/nanjing/beiqihuansu/",cur:0,num:313},{type:"mb",name:"保时捷",url:"/nanjing/porsche/",cur:0,num:294},{type:"mb",name:"北汽绅宝",url:"/nanjing/shenbao/",cur:0,num:246},{type:"mb",name:"奔腾",url:"/nanjing/besturn/",cur:0,num:268},{type:"mb",name:"北京",url:"/nanjing/bjqc/",cur:0,num:255},{type:"mb",name:"北汽威旺",url:"/nanjing/ww/",cur:0,num:239},{type:"mb",name:"北汽制造",url:"/nanjing/beijingjeep/",cur:0,num:51},{type:"mb",name:"宾利",url:"/nanjing/bentley/",cur:0,num:47},{type:"mb",name:"布加迪",url:"/nanjing/bugatti/",cur:0,num:1},{type:"mb",name:"巴博斯",url:"/nanjing/barbus/",cur:0,num:17},{type:"mb",name:"北汽新能源",url:"/nanjing/beiqixinnengyuan/",cur:0,num:35},{type:"mb",name:"宝沃",url:"/nanjing/borgward/",cur:0,num:0},{type:"mb",name:"保斐利",url:"/nanjing/bufori/",cur:0,num:0}],C:[{type:"mb",name:"长安轿车",url:"/nanjing/cajc/",cur:0,num:989},{type:"mb",name:"长安商用",url:"/nanjing/casyc/",cur:0,num:467},{type:"mb",name:"长城",url:"/nanjing/greatwall/",cur:0,num:505},{type:"mb",name:"昌河",url:"/nanjing/changheauto/",cur:0,num:228},{type:"mb",name:"长安跨越",url:"/nanjing/changankuayue-230/",cur:0,num:55},{type:"mb",name:"长城华冠",url:"/nanjing/chautotechnology/",cur:0,num:0},{type:"mb",name:"成功",url:"/nanjing/chenggong/",cur:0,num:1},{type:"mb",name:"长久汽车",url:"/nanjing/changjiu/",cur:0,num:0}],D:[{type:"mb",name:"大众",url:"/nanjing/volkswagen/",cur:0,num:2205},{type:"mb",name:"东风风行",url:"/nanjing/fengxingauto/",cur:0,num:395},{type:"mb",name:"东风风神",url:"/nanjing/fs/",cur:0,num:344},{type:"mb",name:"东南",url:"/nanjing/southeastautomobile/",cur:0,num:200},{type:"mb",name:"东风风光",url:"/nanjing/dongfengfengguang/",cur:0,num:238},{type:"mb",name:"道奇",url:"/nanjing/dodge/",cur:0,num:269},{type:"mb",name:"DS",url:"/nanjing/ds/",cur:0,num:111},{type:"mb",name:"东风小康",url:"/nanjing/dongfengxiaokang-205/",cur:0,num:246},{type:"mb",name:"东风·郑州日产",url:"/nanjing/dongfengzhengzhourichan/",cur:0,num:177},{type:"mb",name:"东风风度",url:"/nanjing/dongfengfengdu/",cur:0,num:136},{type:"mb",name:"东风御风",url:"/nanjing/dongfengyufeng/",cur:0,num:40},{type:"mb",name:"底特律电动车",url:"/nanjing/ditelvdiandongche/",cur:0,num:0}],F:[{type:"mb",name:"丰田",url:"/nanjing/toyota/",cur:0,num:1451},{type:"mb",name:"福特",url:"/nanjing/ford/",cur:0,num:1100},{type:"mb",name:"福田",url:"/nanjing/foton/",cur:0,num:319},{type:"mb",name:"法拉利",url:"/nanjing/ferrari/",cur:0,num:4},{type:"mb",name:"菲亚特",url:"/nanjing/fiat/",cur:0,num:236},{type:"mb",name:"福迪",url:"/nanjing/foday/",cur:0,num:44},{type:"mb",name:"福汽启腾",url:"/nanjing/fujianxinlongmaqichegufenyouxiangongsi/",cur:0,num:59},{type:"mb",name:"飞驰商务车",url:"/nanjing/feichishangwuche/",cur:0,num:11},{type:"mb",name:"Faralli Mazzanti",url:"/nanjing/farallimazzanti/",cur:0,num:0}],G:[{type:"mb",name:"广汽传祺",url:"/nanjing/gq/",cur:0,num:371},{type:"mb",name:"观致汽车",url:"/nanjing/qorosauto/",cur:0,num:87},{type:"mb",name:"广汽吉奥",url:"/nanjing/gonow/",cur:0,num:103},{type:"mb",name:"GMC",url:"/nanjing/gmc-109/",cur:0,num:39},{type:"mb",name:"广汽中兴",url:"/nanjing/gaczxauto/",cur:0,num:35},{type:"mb",name:"光冈",url:"/nanjing/galue/",cur:0,num:0},{type:"mb",name:"GTA",url:"/nanjing/gta/",cur:0,num:0},{type:"mb",name:"广汽日野",url:"/nanjing/guangqihinomotors/",cur:0,num:0}],H:[{type:"mb",name:"哈弗",url:"/nanjing/hafu-196/",cur:0,num:577},{type:"mb",name:"海马",url:"/nanjing/hama/",cur:0,num:429},{type:"mb",name:"红旗",url:"/nanjing/faw-hongqi/",cur:0,num:36},{type:"mb",name:"华泰",url:"/nanjing/huataiautomobile/",cur:0,num:127},{type:"mb",name:"黄海",url:"/nanjing/sgautomotive/",cur:0,num:23},{type:"mb",name:"哈飞",url:"/nanjing/hafeiautomobile/",cur:0,num:4},{type:"mb",name:"海马商用车",url:"/nanjing/fstar/",cur:0,num:4},{type:"mb",name:"华颂",url:"/nanjing/huasong/",cur:0,num:39},{type:"mb",name:"华泰新能源",url:"/nanjing/huataixinnengyuan/",cur:0,num:59},{type:"mb",name:"海格",url:"/nanjing/higer/",cur:0,num:7},{type:"mb",name:"汇众",url:"/nanjing/shanghaihuizhong-45/",cur:0,num:2},{type:"mb",name:"恒天汽车",url:"/nanjing/chtc/",cur:0,num:1}],J:[{type:"mb",name:"吉利汽车",url:"/nanjing/geely/",cur:0,num:714},{type:"mb",name:"江淮",url:"/nanjing/jac/",cur:0,num:463},{type:"mb",name:"Jeep",url:"/nanjing/jeep/",cur:0,num:385},{type:"mb",name:"捷豹",url:"/nanjing/jauger/",cur:0,num:308},{type:"mb",name:"江铃",url:"/nanjing/jmc/",cur:0,num:276},{type:"mb",name:"金杯",url:"/nanjing/jinbei/",cur:0,num:396},{type:"mb",name:"九龙",url:"/nanjing/joylongautomobile/",cur:0,num:7},{type:"mb",name:"金龙",url:"/nanjing/kinglongmotor/",cur:0,num:11},{type:"mb",name:"江铃集团轻汽",url:"/nanjing/jianglingjituanqingqi/",cur:0,num:6},{type:"mb",name:"金旅客车",url:"/nanjing/jlkc/",cur:0,num:2},{type:"mb",name:"江南",url:"/nanjing/jiangnanauto/",cur:0,num:111}],K:[{type:"mb",name:"凯迪拉克",url:"/nanjing/cadillac/",cur:0,num:267},{type:"mb",name:"开瑞",url:"/nanjing/karry/",cur:0,num:134},{type:"mb",name:"克莱斯勒",url:"/nanjing/chrysler/",cur:0,num:214},{type:"mb",name:"凯翼",url:"/nanjing/kaiyi/",cur:0,num:80},{type:"mb",name:"卡威",url:"/nanjing/kawei/",cur:0,num:11},{type:"mb",name:"科尼赛克",url:"/nanjing/koenigsegg/",cur:0,num:0},{type:"mb",name:"科瑞斯的",url:"/nanjing/keruisi/",cur:0,num:1},{type:"mb",name:"康迪",url:"/nanjing/kangdi/",cur:0,num:3},{type:"mb",name:"卡尔森",url:"/nanjing/kaersen/",cur:0,num:0},{type:"mb",name:"KTM",url:"/nanjing/ktm/",cur:0,num:0}],L:[{type:"mb",name:"铃木",url:"/nanjing/suzuki/",cur:0,num:843},{type:"mb",name:"陆风",url:"/nanjing/landwind/",cur:0,num:250},{type:"mb",name:"路虎",url:"/nanjing/landrover/",cur:0,num:530},{type:"mb",name:"雷克萨斯",url:"/nanjing/lexus/",cur:0,num:193},{type:"mb",name:"猎豹汽车",url:"/nanjing/cf/",cur:0,num:270},{type:"mb",name:"雷诺",url:"/nanjing/renult/",cur:0,num:145},{type:"mb",name:"林肯",url:"/nanjing/lincoln/",cur:0,num:104},{type:"mb",name:"兰博基尼",url:"/nanjing/lamborghini/",cur:0,num:6},{type:"mb",name:"力帆",url:"/nanjing/lifanmotors/",cur:0,num:172},{type:"mb",name:"劳斯莱斯",url:"/nanjing/rolls-royce/",cur:0,num:25},{type:"mb",name:"莲花",url:"/nanjing/lotus-146/",cur:0,num:12},{type:"mb",name:"蓝海房车",url:"/nanjing/hailanfangche/",cur:0,num:3},{type:"mb",name:"路特斯",url:"/nanjing/lotus/",cur:0,num:7},{type:"mb",name:"理念",url:"/nanjing/everus/",cur:0,num:388},{type:"mb",name:"雷丁电动",url:"/nanjing/levdeo/",cur:0,num:0},{type:"mb",name:"陆地方舟",url:"/nanjing/ludifangzhou/",cur:0,num:0},{type:"mb",name:"领志",url:"/nanjing/leahead/",cur:0,num:0},{type:"mb",name:"朗世",url:"/nanjing/ranz/",cur:0,num:0}],M:[{type:"mb",name:"马自达",url:"/nanjing/mazda/",cur:0,num:520},{type:"mb",name:"MG",url:"/nanjing/mg-79/",cur:0,num:247},{type:"mb",name:"玛莎拉蒂",url:"/nanjing/maserati/",cur:0,num:105},{type:"mb",name:"MINI",url:"/nanjing/mini/",cur:0,num:108},{type:"mb",name:"迈凯伦",url:"/nanjing/mclaren/",cur:0,num:3},{type:"mb",name:"摩根",url:"/nanjing/morgancars/",cur:0,num:0},{type:"mb",name:"美亚",url:"/nanjing/tianqimeiyaauto/",cur:0,num:0}],N:[{type:"mb",name:"纳智捷",url:"/nanjing/luxgen/",cur:0,num:174},{type:"mb",name:"Noble",url:"/nanjing/noble/",cur:0,num:0}],O:[{type:"mb",name:"讴歌",url:"/nanjing/acura/",cur:0,num:46},{type:"mb",name:"欧朗",url:"/nanjing/ol/",cur:0,num:165},{type:"mb",name:"欧宝",url:"/nanjing/opel/",cur:0,num:0},{type:"mb",name:"欧联",url:"/nanjing/oulian/",cur:0,num:0}],P:[{type:"mb",name:"帕加尼",url:"/nanjing/pagani/",cur:0,num:0},{type:"mb",name:"PGO",url:"/nanjing/pgo/",cur:0,num:0}],Q:[{type:"mb",name:"起亚",url:"/nanjing/kia/",cur:0,num:808},{type:"mb",name:"奇瑞",url:"/nanjing/chery/",cur:0,num:486},{type:"mb",name:"启辰",url:"/nanjing/venucia/",cur:0,num:233},{type:"mb",name:"庆铃",url:"/nanjing/isuzu/",cur:0,num:16},{type:"mb",name:"乔治·巴顿",url:"/nanjing/qiaozhibadun/",cur:0,num:0}],R:[{type:"mb",name:"日产",url:"/nanjing/nissan/",cur:0,num:1080},{type:"mb",name:"荣威",url:"/nanjing/roewe/",cur:0,num:288}],S:[{type:"mb",name:"斯柯达",url:"/nanjing/skoda/",cur:0,num:405},{type:"mb",name:"三菱",url:"/nanjing/mitsubishi/",cur:0,num:424},{type:"mb",name:"斯巴鲁",url:"/nanjing/subaru/",cur:0,num:249},{type:"mb",name:"上汽大通MAXUS",url:"/nanjing/maxus/",cur:0,num:106},{type:"mb",name:"双龙",url:"/nanjing/ssangyong/",cur:0,num:83},{type:"mb",name:"smart",url:"/nanjing/smart/",cur:0,num:146},{type:"mb",name:"山姆",url:"/nanjing/sam/",cur:0,num:2},{type:"mb",name:"STARTECH",url:"/nanjing/startech/",cur:0,num:0},{type:"mb",name:"赛麟SALEEN",url:"/nanjing/saleen/",cur:0,num:1},{type:"mb",name:"世爵",url:"/nanjing/sj/",cur:0,num:0},{type:"mb",name:"陕汽通家",url:"/nanjing/tongjia/",cur:0,num:0},{type:"mb",name:"上喆汽车",url:"/nanjing/shangqiche/",cur:0,num:0}],T:[{type:"mb",name:"特斯拉",url:"/nanjing/tesla/",cur:0,num:15},{type:"mb",name:"泰卡特",url:"/nanjing/techart/",cur:0,num:2},{type:"mb",name:"腾势",url:"/nanjing/denza/",cur:0,num:9}],W:[{type:"mb",name:"五菱",url:"/nanjing/sgmw/",cur:0,num:778},{type:"mb",name:"沃尔沃",url:"/nanjing/volvo/",cur:0,num:243},{type:"mb",name:"五十铃",url:"/nanjing/isuzu-132/",cur:0,num:60},{type:"mb",name:"潍柴英致",url:"/nanjing/enranger/",cur:0,num:72},{type:"mb",name:"威麟",url:"/nanjing/rely/",cur:0,num:6},{type:"mb",name:"威兹曼",url:"/nanjing/wiesmann/",cur:0,num:0},{type:"mb",name:"潍柴欧睿",url:"/nanjing/eurise/",cur:0,num:1}],X:[{type:"mb",name:"现代",url:"/nanjing/hyundai/",cur:0,num:992},{type:"mb",name:"雪佛兰",url:"/nanjing/chevrolet/",cur:0,num:701},{type:"mb",name:"雪铁龙",url:"/nanjing/citroen/",cur:0,num:473},{type:"mb",name:"星客特",url:"/nanjing/xkt/",cur:0,num:5},{type:"mb",name:"新凯",url:"/nanjing/xinkaiauto/",cur:0,num:3},{type:"mb",name:"西雅特",url:"/nanjing/seat/",cur:0,num:0}],Y:[{type:"mb",name:"英菲尼迪",url:"/nanjing/infiniti/",cur:0,num:119},{type:"mb",name:"一汽",url:"/nanjing/faw/",cur:0,num:413},{type:"mb",name:"野马汽车",url:"/nanjing/ym/",cur:0,num:152},{type:"mb",name:"依维柯",url:"/nanjing/iveco/",cur:0,num:35},{type:"mb",name:"永源",url:"/nanjing/jonwayautomobile/",cur:0,num:6},{type:"mb",name:"宇通",url:"/nanjing/yutong/",cur:0,num:0},{type:"mb",name:"御捷",url:"/nanjing/yujie/",cur:0,num:0},{type:"mb",name:"游侠汽车",url:"/nanjing/youxia/",cur:0,num:0},{type:"mb",name:"扬州亚星客车",url:"/nanjing/yangzhouyaxingkeche/",cur:0,num:0}],Z:[{type:"mb",name:"众泰",url:"/nanjing/zotyeauto/",cur:0,num:910},{type:"mb",name:"中华",url:"/nanjing/brillianceauto/",cur:0,num:285},{type:"mb",name:"知豆",url:"/nanjing/zhidou/",cur:0,num:23},{type:"mb",name:"中兴",url:"/nanjing/zxauto/",cur:0,num:111},{type:"mb",name:"中欧奔驰房车",url:"/nanjing/zoemo/",cur:0,num:17},{type:"mb",name:"浙江卡尔森",url:"/nanjing/zhejiangkaersen/",cur:0,num:4},{type:"mb",name:"之诺",url:"/nanjing/zhinuo/",cur:0,num:0},{type:"mb",name:"重汽王牌",url:"/nanjing/zhongqiwangpai/",cur:0,num:0},{type:"mb",name:"中通客车",url:"/nanjing/zhongtongkeche/",cur:0,num:0}]},setcityurl:[{tagname:"baojia",tagurl:"http://price.bitauto.com/mb@objid@",otherpara:"_c@cityid@",allspell:"buick"},{tagname:"yanghu",tagurl:"http://car.bitauto.com/tree_baoyang/mb_@objid@/",otherpara:"?citycode=@cityid@",allspell:"buick"}]}

	arr = []
	aaa[:brand].each{|k,v| arr.concat v}
	arr
  end
end


